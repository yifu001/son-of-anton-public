---
phase: 07-todo-display
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/classes/todoWidget.class.js
  - src/assets/css/mod_todoWidget.css
  - src/ui.html
  - src/_renderer.js
autonomous: true

must_haves:
  truths:
    - "User sees list of todos from active Claude session"
    - "Running tasks show animated spinner icon"
    - "Pending tasks show hollow circle icon"
    - "Completed tasks show checkmark icon in collapsible section"
    - "Widget shows 'No tasks' when no todos exist"
    - "Widget scrolls when more than 5 items"
    - "Header displays task count"
  artifacts:
    - path: "src/classes/todoWidget.class.js"
      provides: "TodoWidget class with event-driven rendering"
      exports: ["TodoWidget"]
    - path: "src/assets/css/mod_todoWidget.css"
      provides: "Widget styling with status icons and scrollbar"
      contains: "@keyframes todoSpinner"
  key_links:
    - from: "src/classes/todoWidget.class.js"
      to: "window.claudeState.todos"
      via: "claude-state-changed event"
      pattern: "addEventListener.*claude-state-changed"
    - from: "src/_renderer.js"
      to: "TodoWidget"
      via: "widget instantiation"
      pattern: "new TodoWidget"
    - from: "src/ui.html"
      to: "src/assets/css/mod_todoWidget.css"
      via: "stylesheet link"
      pattern: "mod_todoWidget\\.css"
---

<objective>
Create TodoWidget to display Claude Code's internal task list for the active session.

Purpose: Provide visibility into what Claude is working on, with status indicators showing running/pending/completed tasks.
Output: Working todo widget in the right column showing session todos with status icons and collapsible completed section.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-todo-display/07-CONTEXT.md
@.planning/phases/07-todo-display/07-RESEARCH.md
@.planning/phases/04-claude-code-state-infrastructure/04-01-SUMMARY.md
@.planning/phases/06-agent-visibility/06-02-SUMMARY.md

Relevant source files:
@src/classes/context.class.js
@src/classes/agentList.class.js
@src/assets/css/mod_context.css
@src/_renderer.js (lines 537-543 for widget instantiation)
@src/ui.html (for CSS/JS loading order)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TodoWidget class</name>
  <files>src/classes/todoWidget.class.js</files>
  <action>
Create `src/classes/todoWidget.class.js` following the ContextWidget/AgentList pattern:

1. Constructor:
   - Accept parentId, throw if missing
   - Create container HTML with id="mod_todoWidget":
     - Inner container with h1 header "TASKS" and count indicator
     - Content div for task list
   - Store DOM references (containerEl, contentEl, headerCountEl)
   - Bind _onStateChange method
   - Subscribe to 'claude-state-changed' event
   - Initialize from window.claudeState if exists

2. State handling (_onStateChange):
   - Get sessionId from window.terminalSessions[window.currentTerm]
   - If no sessionId: render "NO SESSION" state
   - Get todos from state.todos[sessionId]
   - If no todos or empty: render empty state ("No tasks")
   - Otherwise: separate into active (pending/in_progress) and completed arrays
   - Call _render(activeTodos, completedTodos)
   - Update header count: "TASKS (N)" where N = total count

3. Rendering (_render):
   - Active section: each task gets:
     - Task index number ("1.", "2.", etc.)
     - Status icon span with class 'todo-status-icon' + status (running/pending)
       - Map status: in_progress -> running, pending -> pending
     - Content span with CSS line-clamp for 2-line max
   - Completed section: use `<details>` element with `<summary>`:
     - Summary text: "COMPLETED (N)"
     - Completed items dimmed, each with checkmark icon
   - Use _escapeHtml helper for XSS safety

4. Helper methods:
   - _renderEmpty(): "No tasks" message
   - _renderNoSession(): "NO SESSION" indicator
   - _escapeHtml(text): Escape HTML entities

Use status mapping: in_progress -> "running", pending -> "pending", completed -> "completed"
  </action>
  <verify>File exists and exports TodoWidget class. Syntax check with `node --check src/classes/todoWidget.class.js`</verify>
  <done>TodoWidget class exists with constructor, event subscription, and render logic</done>
</task>

<task type="auto">
  <name>Task 2: Create TodoWidget CSS styling</name>
  <files>src/assets/css/mod_todoWidget.css</files>
  <action>
Create `src/assets/css/mod_todoWidget.css` following mod_context.css pattern:

1. Base container (div#mod_todoWidget):
   - border-top: 0.092vh solid rgba(var(--color_r), var(--color_g), var(--color_b), 0.3)
   - font-family: var(--font_main_light)
   - letter-spacing: 0.092vh
   - padding: 0.645vh 0vh
   - display: flex
   - Add ::before and ::after corner accents (copy from mod_context.css)

2. Inner container:
   - flex-direction: column
   - width: 100%

3. Header (h1):
   - font-size: 1.48vh
   - margin: 0vh
   - Task count indicator styled like mod_context_headerInfo

4. Content area (scrollable):
   - max-height: 15vh (approximately 5 items)
   - overflow-y: auto
   - Thin scrollbar (scrollbar-width: thin)
   - Scrollbar hidden by default, appears on hover

5. Task item styling:
   - display: flex
   - align-items: flex-start
   - padding: 0.3vh 0
   - border-bottom: 1px dotted with low opacity

6. Task index number:
   - min-width: 2em
   - opacity: 0.6

7. Status icons (@keyframes todoSpinner):
   - .todo-status-icon: display inline-block, width/height 1em, flex-shrink 0
   - .todo-status-icon.running: border spinner animation (1s linear infinite)
   - .todo-status-icon.pending: hollow circle (border-radius 50%, border only)
   - .todo-status-icon.completed: checkmark via ::after pseudo-element

8. Task content:
   - -webkit-line-clamp: 2
   - -webkit-box-orient: vertical
   - display: -webkit-box
   - overflow: hidden
   - word-break: break-word

9. Completed section (`<details>`):
   - border-top separator line
   - margin-top: 0.5vh
   - summary: cursor pointer, opacity 0.6, list-style none
   - summary::before: arrow indicators (down when open, right when closed)
   - .completed-items: opacity 0.5

10. Empty state:
   - text-align: center
   - opacity: 0.5
   - padding: 1vh 0
  </action>
  <verify>File exists. CSS syntax valid (no browser needed - just verify file creates without errors)</verify>
  <done>mod_todoWidget.css exists with spinner animation, status icons, scrollable container, and collapsible completed section</done>
</task>

<task type="auto">
  <name>Task 3: Integrate TodoWidget into application</name>
  <files>src/ui.html, src/_renderer.js</files>
  <action>
1. Update `src/ui.html`:
   - Add CSS link after mod_context.css (around line 40):
     `<link rel="stylesheet" href="assets/css/mod_todoWidget.css" />`
   - Add script tag after context.class.js (around line 67):
     `<script src="classes/todoWidget.class.js"></script>`

2. Update `src/_renderer.js`:
   - Find widget instantiation section (around lines 537-543):
     ```
     window.mods.netstat = new Netstat("mod_column_right");
     window.mods.globe = new LocationGlobe("mod_column_right");
     window.mods.conninfo = new Conninfo("mod_column_right");
     ```
   - Add TodoWidget instantiation AFTER conninfo (right column, below existing widgets):
     `window.mods.todoWidget = new TodoWidget("mod_column_right");`
  </action>
  <verify>
Run app with `npm start` from project root. Verify:
1. TodoWidget appears in right column below conninfo
2. No console errors related to TodoWidget
3. Widget shows "NO SESSION" or "No tasks" state initially
  </verify>
  <done>TodoWidget integrated - CSS loaded, JS loaded, widget instantiated in right column</done>
</task>

</tasks>

<verification>
Overall phase verification:
1. Start app (`npm start`)
2. Right column shows TodoWidget below connection info
3. When Claude session active in terminal:
   - Widget header shows "TASKS (N)" with count
   - Running tasks show spinning icon
   - Pending tasks show hollow circle
   - Completed tasks in collapsible section with checkmarks
4. When no session: widget shows "NO SESSION"
5. When session but no todos: widget shows "No tasks"
6. Scrollbar appears on hover when >5 items
</verification>

<success_criteria>
- [ ] TodoWidget class created with event-driven state handling
- [ ] CSS styling matches right-column widget pattern
- [ ] Widget integrated in ui.html and _renderer.js
- [ ] Status icons display correctly (spinner, circle, checkmark)
- [ ] Completed section collapsible via details/summary
- [ ] Scrollable when more than 5 items
- [ ] Requirements TODO-01, TODO-02, TODO-03 satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/07-todo-display/07-01-SUMMARY.md`
</output>
